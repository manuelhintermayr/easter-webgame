<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Ostereiersuche im Office</title>
    <style>
      body {
        margin: 0;
        background: #000;
        font-family: monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        color: white;
      }

      #hud {
        margin-top: 10px;
        font-size: 18px;
      }

      #game {
        display: grid;
        grid-template-columns: repeat(10, 32px);
        grid-template-rows: repeat(10, 32px);
        gap: 0;
        margin-top: 10px;
        image-rendering: pixelated;
      }

      .tile {
        width: 32px;
        height: 32px;
        background-color: #bfb89a;
        position: relative;
        /* background-image: url("egg.png");
        background-repeat: no-repeat;
        background-size: 170px 256px;
        background-position: -42px -41px;
         */
         background-color: #cbbd94;
  background-image: 
    linear-gradient(to right, #a39067 1px, transparent 1px),
    linear-gradient(to bottom, #a39067 1px, transparent 1px),
    linear-gradient(to right, #b4a677 1px, transparent 1px),
    linear-gradient(to bottom, #b4a677 1px, transparent 1px);
  background-size: 8px 8px, 8px 8px, 32px 32px, 32px 32px;
      }

      .entity {
        width: 32px;
        height: 32px;
        position: absolute;
        top: 0;
        left: 0;
        background-repeat: no-repeat;
        background-size: 128px 128px;
      }

      .player {
        background-image: url("player_male.png");
        background-size: 133px 32px;
        width: 32px;
        height: 32px;
        position: absolute;
        background-repeat: no-repeat;
        /* background-size: auto; */
      }

      .npc {
        background-image: url("spritesheet.png"); /* kann extra NPC sheet sein */
        background-position: -32px 0;
        z-index: 2;
      }

      .egg {
        background-image: url("egg.png");
        z-index: 1;
      }

      .object {
        background-image: url("objekte.png");
        z-index: 1;
      }

      #dialogBox {
        margin-top: 10px;
        width: 320px;
        min-height: 80px;
        background: #f4e9cd;
        border: 3px double #222;
        box-shadow: 4px 4px 0 #000;
        padding: 10px;
        color: #111;
        font-family: monospace;
        font-size: 14px;
        position: relative;
        display: none;
      }

      #dialogText {
        white-space: pre-wrap;
      }

      .dialog-buttons {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }

      .dialog-buttons button {
        background: #fff;
        border: 2px solid #000;
        font-family: monospace;
        font-size: 14px;
        margin: 0 10px;
        padding: 2px 12px;
        cursor: pointer;
        transition: transform 0.1s;
      }

      .dialog-buttons button:hover {
        background: #eee;
        transform: scale(1.05);
      }

      #hud {
        background: #000;
        padding: 5px 15px;
        font-family: monospace;
        font-size: 18px;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 10px;
      }
    </style>
  </head>
  <body>
    <div id="hud">ðŸ¥š Gefundene Eier: <span id="eggCount">0</span>/10</div>
    <div id="game"></div>

    <div id="dialogBox">
      <div id="dialogText">...</div>
      <div class="dialog-buttons" id="dialogChoices">
        <button onclick="handleChoice(true)">Ja</button>
        <button onclick="handleChoice(false)">Nein</button>
      </div>
    </div>

    <script>
      const spritePositions = {
        down: [0, 0],
        up: [-32, 0],
        left: [-64, 0],
        right: [-96, 0],
      };
      const width = 10;
      const height = 20;
      const game = document.getElementById("game");
      const eggCount = document.getElementById("eggCount");
      const dialogBox = document.getElementById("dialogBox");
      const dialogText = document.getElementById("dialogText");
      const dialogChoices = document.getElementById("dialogChoices");

      const player = { x: 1, y: 1, direction: "down", frame: 0 };
      let eggs = [
        [1, 3],
        [2, 5],
        [3, 3],
        [4, 9],
        [5, 2],
        [6, 7],
        [7, 1],
        [8, 4],
        [9, 8],
        [1, 9],
      ];
      const objects = [
        [1, 3],
        [3, 1],
        [5, 5],
        [6, 2],
        [7, 7],
      ];
      const npcs = [
        {
          x: 2,
          y: 2,
          text: "Ich habe ein Ei zuletzt in der NÃ¤he eines Laptops gesehen...",
          tip: "Schau mal bei den Schreibtischen.",
        },
        {
          x: 6,
          y: 6,
          text: "Ich glaube da war eines bei der Kaffeemaschine!",
          tip: "Vielleicht beim Fenster.",
        },
        {
          x: 4,
          y: 1,
          text: "Ein Ei versteckt sich hinter dem BÃ¼cherregal.",
          tip: "Unten rechts vielleicht?",
        },
      ];

      function drawMap() {
        game.innerHTML = "";
        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            const tile = document.createElement("div");
            tile.classList.add("tile");

            const egg = eggs.find((e) => e[0] === x && e[1] === y);
            const obj = objects.find((o) => o[0] === x && o[1] === y);
            const npc = npcs.find((n) => n.x === x && n.y === y);

            if (egg) {
              const e = document.createElement("div");
              e.classList.add("entity", "egg");
              tile.appendChild(e);
            }

            if (obj) {
              const o = document.createElement("div");
              o.classList.add("entity", "object");
              tile.appendChild(o);
            }

            if (npc) {
              const n = document.createElement("div");
              n.classList.add("entity", "npc");
              tile.appendChild(n);
            }

            if (player.x === x && player.y === y) {
              const p = document.createElement("div");
              p.classList.add("entity", "player");
              const [bgX, bgY] = spritePositions[player.direction];
              p.style.backgroundPosition = `${bgX}px ${bgY}px`;
              tile.appendChild(p);
            }

            game.appendChild(tile);
          }
        }
      }

      function isBlocked(x, y) {
        if (x < 0 || y < 0 || x >= width || y >= height) return true;
        if (eggs.some((e) => e[0] === x && e[1] === y)) return true;
        if (objects.some((o) => o[0] === x && o[1] === y)) return true;
        if (npcs.some((n) => n.x === x && n.y === y)) return true;
        return false;
      }

      function tryPickup(x, y) {
        for (let i = 0; i < eggs.length; i++) {
          if (Math.abs(eggs[i][0] - x) + Math.abs(eggs[i][1] - y) === 1) {
            eggs.splice(i, 1);
            eggCount.textContent = 10 - eggs.length;
            return true;
          }
        }
        return false;
      }

      let pendingTip = null;

      function checkInteraction() {
        for (let npc of npcs) {
          if (Math.abs(npc.x - player.x) + Math.abs(npc.y - player.y) === 1) {
            dialogBox.style.display = "block";
            dialogText.textContent = npc.text;
            pendingTip = npc.tip;
            dialogChoices.style.display = "flex";
            return;
          }
        }
        tryPickup(player.x, player.y);
      }

      function handleChoice(choice) {
        if (choice && pendingTip) {
          dialogText.textContent = "ðŸ§  Hinweis: " + pendingTip;
          dialogChoices.style.display = "none";
        } else {
          dialogBox.style.display = "none";
        }
        pendingTip = null;
      }

      function move(dx, dy, dir) {
        const newX = player.x + dx;
        const newY = player.y + dy;
        player.direction = dir;
        if (!isBlocked(newX, newY)) {
          player.x = newX;
          player.y = newY;
        }
        drawMap();
      }

      document.addEventListener("keydown", (e) => {
        if (dialogBox.style.display === "block") return;
        if (e.key === "w") move(0, -1, "up");
        if (e.key === "s") move(0, 1, "down");
        if (e.key === "a") move(-1, 0, "left");
        if (e.key === "d") move(1, 0, "right");
        if (e.key === " ") checkInteraction();
      });

      drawMap();
    </script>
  </body>
</html>
